name: Auto Check Delta Android Update

on:
  schedule:
    - cron: "0 */6 * * *"
  workflow_dispatch:

jobs:
  check-update:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repo
        uses: actions/checkout@v4

      - name: Fetch page
        run: |
          curl -s https://deltaexploits.gg/delta-executor-android > page.html

      - name: Extract version
        run: |
          grep -oE 'Delta-[0-9\.]+-[0-9]+\.apk' page.html | head -n 1 > latest.txt
          echo "LATEST=$(cat latest.txt)" >> $GITHUB_ENV

      - name: Save version
        run: |
          mkdir -p data
          if [ ! -f data/version.txt ] || [ "$(cat data/version.txt)" != "$LATEST" ]; then
            echo "$LATEST" > data/version.txt
            echo "{\"version\":\"$LATEST\",\"updated\":\"$(date -u +'%Y-%m-%dT%H:%M:%SZ')\"}" > data/version.json
          fi

      - name: Commit
        run: |
          git config user.name "github-actions"
          git config user.email "actions@github.com"
          git add data/version.*
          git commit -m "Auto update Delta version" || echo "No change"
          git push
