<!doctype html>
<html lang="vi">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>Milo Pha ÄÃ¡</title>
  <link rel="stylesheet" href="effect.css?v=9">
</head>

<body class="dark">
  <div class="bg"></div>

  <main class="wrap">
    <div class="top-actions">
      <button class="pill" id="btnTheme" type="button" aria-label="Toggle theme">
        ğŸŒ™ <span id="themeText">Dark</span>
      </button>

      <button class="pill" id="btnAdmin" type="button" aria-label="Open admin">
        ğŸ”’ <span id="adminText">Admin</span>
      </button>
    </div>

    <section class="card header">
      <img class="cover" src="cover.gif" alt="Cover" />

      <div class="header-inner">
        <div class="avatar-wrap">
          <img class="avatar" src="avatar.jpg" alt="Avatar" />
          <img class="avatar-frame" src="frame.png" alt="" />
        </div>

        <div class="who">
          <h1 class="name" id="nameText">Milo Pha ÄÃ¡ (Nhat boy)</h1>
          <div class="subtitle" id="subtitleText">IT Student â€¢ Software Engineering</div>
          <div class="quote" id="quoteText">â€œMá»™t gÃ³c nhá» trÃªn Internet cá»§a Milo.â€</div>

          <div class="chips">
            <div class="chip"><span>ğŸ“</span> <span id="cityText">Há»“ ChÃ­ Minh</span></div>
            <div class="chip"><span>ğŸ‚</span> <span id="ageText">19</span></div>
            <div class="chip"><span>ğŸ®</span> <span id="tagText">gamer</span></div>
          </div>
        </div>
      </div>
    </section>

    <section class="grid">
      <div class="card section">
        <div class="h">ğŸ§ Nháº¡c tÃ´i nghe</div>
        <div class="music-title">Äang nghe: <span id="songName">Ai ngoÃ i anh</span></div>
        <div class="p">Báº¥m Play Ä‘á»ƒ nghe ğŸ§</div>
        <div style="height:10px"></div>
        <audio id="audio" controls src="music.mp3"></audio>
      </div>

      <div class="card section">
        <div class="h">ğŸ“Œ Giá»›i thiá»‡u</div>
        <div class="list" id="introList"></div>
      </div>

      <div class="card section">
        <div class="h">ğŸ® Game mÃ¬nh hay chÆ¡i</div>
        <div class="list" id="gameList"></div>
        <p class="help">Admin cÃ³ thá»ƒ dÃ¡n link tÃ i khoáº£n game Ä‘á»ƒ ngÆ°á»i xem báº¥m vÃ o.</p>
      </div>

      <div class="card section">
        <div class="h">ğŸ”— LiÃªn há»‡</div>
        <div class="contacts">
          <a class="contact-btn" id="fbBtn" href="#" target="_blank" rel="noopener">ğŸŒ Facebook</a>
          <a class="contact-btn" id="dcBtn" href="#" target="_blank" rel="noopener">ğŸ’¬ Discord</a>
        </div>
        <p class="help" id="dcHint">Discord: nháº­p ID lÃ  tá»± táº¡o link profile.</p>
      </div>
    </section>

    <section class="card tus-box">
      <div class="tus-head">
        <div>ğŸ“ ÄÃ¢y lÃ  nÆ¡i check cÃ¡c tus cá»§a tÃ´i</div>
        <button class="btn btn-primary" id="btnAddTus" type="button">â• ThÃªm tus</button>
      </div>
      <div class="p">NgÆ°á»i xem chá»‰ báº¥m link â€¢ Admin má»›i thÃªm/xoÃ¡ ğŸ”’</div>
      <div class="tus-list" id="tusList"></div>
    </section>

    <section class="card schedule">
      <div class="h">ğŸ“… Lá»‹ch báº­n / ráº£nh</div>
      <div class="p">Set theo tá»«ng ngÃ y trong tuáº§n âœ…</div>
      <div class="day-tabs" id="dayTabs"></div>
      <div id="daySlots"></div>
    </section>
  </main>

  <div class="modal" id="adminModal" aria-hidden="true">
    <div class="modal-card" role="dialog" aria-modal="true">
      <button class="modal-close" id="adminClose" aria-label="Close">âœ•</button>
      <h2 class="modal-title">ğŸ” Admin Panel</h2>

      <div class="field">
        <label>Máº­t kháº©u admin</label>
        <input id="adminPassInput" type="password" placeholder="Nháº­p pass..." />
      </div>

      <div class="modal-actions">
        <button class="btn btn-primary" id="btnLogin" type="button">âœ… ÄÄƒng nháº­p</button>
        <button class="btn btn-danger" id="btnLogout" type="button">ğŸšª ThoÃ¡t</button>
      </div>

      <hr class="hr">

      <div id="adminLocked" class="admin-locked">
        <div class="row">
          <div class="field">
            <label>Link Facebook (dÃ¡n link profile)</label>
            <input id="fbInput" placeholder="https://facebook.com/..." />
          </div>
          <div class="field">
            <label>Discord ID (chá»‰ cáº§n ID)</label>
            <input id="dcIdInput" placeholder="9103..." />
          </div>
        </div>

        <div class="row">
          <div class="field">
            <label>Link Roblox (tÃ i khoáº£n)</label>
            <input id="robloxInput" placeholder="DÃ¡n link (cÃ³ thá»ƒ Ä‘á»ƒ trá»‘ng)" />
          </div>
          <div class="field">
            <label>Link Valorant (tÃ i khoáº£n / tracker)</label>
            <input id="valoInput" placeholder="DÃ¡n link (cÃ³ thá»ƒ Ä‘á»ƒ trá»‘ng)" />
          </div>
        </div>

        <div class="row">
          <div class="field">
            <label>Link TFT (tÃ i khoáº£n / tracker)</label>
            <input id="tftInput" placeholder="DÃ¡n link (cÃ³ thá»ƒ Ä‘á»ƒ trá»‘ng)" />
          </div>
          <div class="field">
            <label>TÃªn bÃ i nháº¡c hiá»ƒn thá»‹</label>
            <input id="songInput" placeholder="Ai ngoÃ i anh" />
          </div>
        </div>

        <div class="row">
          <div class="field">
            <label>Äá»•i máº­t kháº©u admin (tuá»³ chá»n)</label>
            <input id="newPassInput" placeholder="Äá»ƒ trá»‘ng náº¿u khÃ´ng Ä‘á»•i" />
          </div>
          <div class="field">
            <label>&nbsp;</label>
            <div class="help">Máº­t kháº©u hiá»‡n táº¡i: <b>079268</b></div>
          </div>
        </div>

        <hr class="hr">

        <div class="row">
          <div class="field">
            <label>â• ThÃªm tus má»›i</label>
            <input id="tusTitleInput" placeholder="TÃªn tus (vd: Tus AV)" />
            <input id="tusLinkInput" placeholder="DÃ¡n link tus Facebook..." />
            <button class="btn btn-ghost" id="btnAddTusAdmin" type="button">â• ThÃªm tus</button>
          </div>

          <div class="field">
            <label>ğŸ“… ThÃªm lá»‹ch báº­n / ráº£nh</label>
            <select id="daySelect"></select>

            <div class="row" style="margin-top:0">
              <div class="field">
                <label>Tá»« giá»</label>
                <input id="fromInput" placeholder="09:00" />
              </div>
              <div class="field">
                <label>Äáº¿n giá»</label>
                <input id="toInput" placeholder="11:30" />
              </div>
            </div>

            <textarea id="taskInput" placeholder="Viá»‡c gÃ¬? (vd: Há»c PRF192 / Ä‘i gym / lÃ m bÃ i...)"></textarea>
            <button class="btn btn-ghost" id="btnAddSlot" type="button">â• ThÃªm lá»‹ch</button>
          </div>
        </div>

        <div class="modal-actions">
          <button class="btn btn-primary" id="btnSave" type="button">ğŸ’¾ LÆ°u cÃ i Ä‘áº·t</button>
        </div>
      </div>

      <div id="adminHint" class="help">
        Nháº­p Ä‘Ãºng máº­t kháº©u thÃ¬ pháº§n cÃ i Ä‘áº·t phÃ­a dÆ°á»›i má»›i hiá»‡n ra.
      </div>
    </div>
  </div>

  <script>
    // =========================
    // âœ… Cloud API (Apps Script)
    // =========================
    const API_URL = "https://script.google.com/macros/s/AKfycbyfWD-Fcm5uaTqPmnA_ShICsLCEO88xudh3h7Fc53l2gXtmz5oJO4Ygje4cK4xOiDF7AA/exec";

    // ====== default data ======
    const DEFAULT = {
      theme: "dark",
      songName: "Ai ngoÃ i anh",
      links: {
        fb: "https://www.facebook.com/milo.pha.a",
        dcId: "910327589309145109",
        roblox: "",
        valo: "",
        tft: ""
      },
      tus: [],
      intro: ["âœ¨ Cháº¡y Ngay Äi", "ğŸ”¥ Cháº¡y VÃ o TrÃ¡i Tim Em", "ğŸ˜¶ ÄÃ¹a ThÃ´i Anh LÃ m GÃ¬ CÃ³ Em"],
      games: [
        { name:"Roblox", desc:"chill / sandbox", tag:"casual", url:"" },
        { name:"Valorant", desc:"FPS / tryhard", tag:"rank", url:"" },
        { name:"TFT", desc:"auto chess", tag:"brain", url:"" }
      ],
      schedule: {
        "Thá»© 2": [],
        "Thá»© 3": [],
        "Thá»© 4": [],
        "Thá»© 5": [],
        "Thá»© 6": [],
        "Thá»© 7": [],
        "Chá»§ nháº­t": []
      },
      adminPass: "079268"
    };

    // ====== helpers ======
    const $ = (id) => document.getElementById(id);

    async function loadData(){
      const res = await fetch(API_URL, { method: "GET" });
      const dataCloud = await res.json();
      return dataCloud && Object.keys(dataCloud).length
        ? { ...DEFAULT, ...dataCloud }
        : structuredClone(DEFAULT);
    }

    async function saveData(data){
      // âœ… Ä‘á»«ng set headers Ä‘á»ƒ trÃ¡nh preflight/CORS drama
      await fetch(API_URL, {
        method: "POST",
        body: JSON.stringify(data)
      });
    }

    // ====== state ======
    let data = structuredClone(DEFAULT);
    let isAdmin = false;
    let activeDay = "Thá»© 2";

    // ====== theme ======
    function applyTheme(){
      document.body.classList.toggle("light", data.theme === "light");
      document.body.classList.toggle("dark", data.theme !== "light");
      $("themeText").textContent = data.theme === "light" ? "Light" : "Dark";
    }

    $("btnTheme").addEventListener("click", async () => {
      data.theme = (data.theme === "light") ? "dark" : "light";
      await saveData(data);
      applyTheme();
    });

    // ====== intro ======
    function renderIntro(){
      const box = $("introList");
      box.innerHTML = "";
      data.intro.forEach(t => {
        const div = document.createElement("div");
        div.className = "item";
        div.innerHTML = `<span>${t}</span>`;
        box.appendChild(div);
      });
    }

    // ====== games ======
    function renderGames(){
      const box = $("gameList");
      box.innerHTML = "";
      data.games.forEach(g => {
        const el = document.createElement(g.url ? "a" : "div");
        el.className = "item";
        if (g.url){
          el.href = g.url;
          el.target = "_blank";
          el.rel = "noopener";
          el.style.textDecoration = "none";
          el.style.color = "inherit";
        }
        el.innerHTML = `
          <div>
            <div style="font-weight:1000">${g.name}</div>
            <div class="p" style="margin-top:2px">${g.desc}</div>
            <div class="p" style="margin-top:2px">${g.url ? "" : "ChÆ°a cÃ³ link"}</div>
          </div>
          <span class="tag">${g.tag}</span>
        `;
        box.appendChild(el);
      });
    }

    // ====== contacts ======
    function renderContacts(){
      $("fbBtn").href = data.links.fb || "#";
      const dcId = (data.links.dcId || "").trim();
      $("dcBtn").href = dcId ? `https://discord.com/users/${dcId}` : "#";
    }

    // ====== tus ======
    function renderTus(){
      const box = $("tusList");
      box.innerHTML = "";

      if (!data.tus.length){
        const empty = document.createElement("div");
        empty.className = "item";
        empty.innerHTML = "ChÆ°a cÃ³ tus nÃ o ğŸ¥²";
        box.appendChild(empty);
        return;
      }

      data.tus.forEach((t, i) => {
        const a = document.createElement("a");
        a.className = "tus-link";
        a.href = t.url || "#";
        a.target = "_blank";
        a.rel = "noopener";
        a.innerHTML = `
          <span>ğŸ”— ${t.title || "Tus"}</span>
          <span class="tag">${isAdmin ? "xoÃ¡" : "má»Ÿ"}</span>
        `;

        if (isAdmin){
          a.addEventListener("click", async (e) => {
            e.preventDefault();
            if (confirm("XoÃ¡ tus nÃ y?")) {
              data.tus.splice(i, 1);
              await saveData(data);
              renderTus();
            }
          });
        }
        box.appendChild(a);
      });
    }

    // ====== schedule ======
    const DAYS = ["Thá»© 2","Thá»© 3","Thá»© 4","Thá»© 5","Thá»© 6","Thá»© 7","Chá»§ nháº­t"];

    function renderDayTabs(){
      const tabs = $("dayTabs");
      tabs.innerHTML = "";
      DAYS.forEach(d => {
        const b = document.createElement("button");
        b.type = "button";
        b.className = "tab" + (d === activeDay ? " active" : "");
        b.textContent = d;
        b.addEventListener("click", () => {
          activeDay = d;
          renderDayTabs();
          renderSlots();
        });
        tabs.appendChild(b);
      });
    }

    function renderSlots(){
      const box = $("daySlots");
      box.innerHTML = "";
      const slots = data.schedule[activeDay] || [];

      if (!slots.length){
        const div = document.createElement("div");
        div.className = "item";
        div.textContent = `ğŸ˜¶ ChÆ°a cÃ³ lá»‹ch cho ${activeDay}.`;
        box.appendChild(div);
        return;
      }

      slots.forEach((s, idx) => {
        const row = document.createElement("div");
        row.className = "slot";
        row.innerHTML = `
          <div class="slot-left">
            <div class="slot-title">${s.task}</div>
            <div class="slot-time">â° ${s.from} - ${s.to}</div>
          </div>
          <div>
            <span class="tag">${isAdmin ? "xoÃ¡" : "báº­n"}</span>
          </div>
        `;

        if (isAdmin){
          row.style.cursor = "pointer";
          row.addEventListener("click", async () => {
            if (confirm("XoÃ¡ lá»‹ch nÃ y?")){
              data.schedule[activeDay].splice(idx, 1);
              await saveData(data);
              renderSlots();
            }
          });
        }
        box.appendChild(row);
      });
    }

    // ====== Admin modal ======
    function openAdmin(){
      $("adminModal").classList.add("show");
      $("adminModal").setAttribute("aria-hidden","false");
      $("adminPassInput").focus();
    }
    function closeAdmin(){
      $("adminModal").classList.remove("show");
      $("adminModal").setAttribute("aria-hidden","true");
    }

    $("btnAdmin").addEventListener("click", openAdmin);
    $("adminClose").addEventListener("click", closeAdmin);
    $("adminModal").addEventListener("click", (e) => {
      if (e.target.id === "adminModal") closeAdmin();
    });

    function syncAdminUI(){
      document.body.classList.toggle("admin-on", isAdmin);
      $("adminLocked").style.display = isAdmin ? "block" : "none";
      $("adminHint").style.display = isAdmin ? "none" : "block";
      $("adminText").textContent = isAdmin ? "Admin âœ“" : "Admin";
      $("btnAddTus").style.display = isAdmin ? "inline-flex" : "none";
      renderTus();
      renderSlots();
    }

    function fillAdminInputs(){
      $("fbInput").value = data.links.fb || "";
      $("dcIdInput").value = data.links.dcId || "";
      $("robloxInput").value = data.links.roblox || "";
      $("valoInput").value = data.links.valo || "";
      $("tftInput").value = data.links.tft || "";
      $("songInput").value = data.songName || "";
      $("newPassInput").value = "";

      $("daySelect").innerHTML = DAYS.map(d => `<option value="${d}">${d}</option>`).join("");
      $("daySelect").value = activeDay;
    }

    $("btnLogin").addEventListener("click", () => {
      const pass = $("adminPassInput").value.trim();
      if (pass === data.adminPass){
        isAdmin = true;
        $("adminPassInput").value = "";
        fillAdminInputs();
        syncAdminUI();
        alert("ÄÄƒng nháº­p thÃ nh cÃ´ng âœ…");
      } else {
        alert("Sai máº­t kháº©u ğŸ˜­");
      }
    });

    $("btnLogout").addEventListener("click", () => {
      isAdmin = false;
      syncAdminUI();
      alert("ÄÃ£ thoÃ¡t admin.");
    });

    $("daySelect").addEventListener("change", (e) => {
      activeDay = e.target.value;
      renderDayTabs();
      renderSlots();
    });

    $("btnAddTus").addEventListener("click", () => {
      if (!isAdmin) return alert("Chá»‰ admin má»›i thÃªm Ä‘Æ°á»£c ğŸ˜­");
      openAdmin();
      setTimeout(()=> $("tusTitleInput").focus(), 80);
    });

    $("btnAddTusAdmin").addEventListener("click", async () => {
      if (!isAdmin) return;
      const title = $("tusTitleInput").value.trim();
      const url = $("tusLinkInput").value.trim();
      if (!title || !url) return alert("Nháº­p Ä‘á»§ TÃªn tus + Link ğŸ˜­");
      data.tus.unshift({ title, url });
      $("tusTitleInput").value = "";
      $("tusLinkInput").value = "";
      await saveData(data);
      renderTus();
    });

    $("btnAddSlot").addEventListener("click", async () => {
      if (!isAdmin) return;
      const day = $("daySelect").value;
      const from = $("fromInput").value.trim();
      const to = $("toInput").value.trim();
      const task = $("taskInput").value.trim();
      if (!from || !to || !task) return alert("Nháº­p Ä‘á»§ tá»« giá» / Ä‘áº¿n giá» / viá»‡c ğŸ˜­");
      if (!data.schedule[day]) data.schedule[day] = [];
      data.schedule[day].unshift({ from, to, task });
      $("taskInput").value = "";
      await saveData(data);
      activeDay = day;
      renderDayTabs();
      renderSlots();
    });

    $("btnSave").addEventListener("click", async () => {
      if (!isAdmin) return;

      data.links.fb = $("fbInput").value.trim();
      data.links.dcId = $("dcIdInput").value.trim();
      data.links.roblox = $("robloxInput").value.trim();
      data.links.valo = $("valoInput").value.trim();
      data.links.tft = $("tftInput").value.trim();
      data.songName = $("songInput").value.trim() || DEFAULT.songName;

      const newPass = $("newPassInput").value.trim();
      if (newPass) data.adminPass = newPass;

      await saveData(data);
      renderContacts();
      $("songName").textContent = data.songName;
      renderGames();
      alert("ÄÃ£ lÆ°u âœ…");
    });

    // ====== init ======
    function init(){
      applyTheme();
      $("songName").textContent = data.songName;

      renderIntro();
      renderGames();
      renderContacts();

      renderDayTabs();
      renderSlots();
      syncAdminUI();
    }

    // âœ… BOOT: load cloud data first
    async function boot(){
      data = await loadData();
      init();
    }
    boot();
  </script>
</body>
</html>
